const A="https://market-api.newestgpt.com";async function b(f,l,E,p="intraday",t){var d;const a=await fetch(`${A}/api/ai/chat`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({messages:f,stockData:l,mode:p})});if(!a.ok)throw new Error(`AI API error: ${a.status}`);const c=(d=a.body)==null?void 0:d.getReader();if(!c)throw new Error("No response body");const w=new TextDecoder;let r="";for(;;){const{done:y,value:g}=await c.read();if(y)break;const m=w.decode(g,{stream:!0}).split(`
`).filter(s=>s.trim());for(const s of m)if(s.startsWith("data: ")){const n=s.slice(6);if(n==="[DONE]")continue;try{const e=JSON.parse(n);if(e.content!==void 0){const i=e.content,o=e.type||"text";o==="think_start"?(r+="<think>",t==null||t("<think>")):o==="think_end"?(r+="</think>",t==null||t("</think>")):(r+=i,t==null||t(i))}if(e.error)throw new Error(e.error)}catch(e){console.error("Parse error:",e)}}}return r}export{b as sendChatMessage};
