const u="https://market-board-api.945036663.workers.dev";async function A(i,d,f,l="intraday",r){var a;const o=await fetch(`${u}/api/ai/chat`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({messages:i,stockData:d,chartData:f,mode:l})});if(!o.ok)throw new Error(`AI API error: ${o.status}`);const n=(a=o.body)==null?void 0:a.getReader();if(!n)throw new Error("No response body");const p=new TextDecoder;let s="";for(;;){const{done:w,value:h}=await n.read();if(w)break;const y=p.decode(h,{stream:!0}).split(`
`).filter(t=>t.trim());for(const t of y)if(t.startsWith("data: ")){const c=t.slice(6);if(c==="[DONE]")continue;try{const e=JSON.parse(c);if(e.content&&(s+=e.content,r==null||r(e.content)),e.error)throw new Error(e.error)}catch(e){console.error("Parse error:",e)}}}return s}export{A as sendChatMessage};
