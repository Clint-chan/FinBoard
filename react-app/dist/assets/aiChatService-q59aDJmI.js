const y="https://market-api.newestgpt.com";async function A(i,d,u,f="intraday",r){var s;const o=await fetch(`${y}/api/ai/chat`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({messages:i,stockData:d,mode:f})});if(!o.ok)throw new Error(`AI API error: ${o.status}`);const n=(s=o.body)==null?void 0:s.getReader();if(!n)throw new Error("No response body");const l=new TextDecoder;let a="";for(;;){const{done:p,value:h}=await n.read();if(p)break;const w=l.decode(h,{stream:!0}).split(`
`).filter(t=>t.trim());for(const t of w)if(t.startsWith("data: ")){const c=t.slice(6);if(c==="[DONE]")continue;try{const e=JSON.parse(c);if(e.content&&(a+=e.content,r==null||r(e.content)),e.error)throw new Error(e.error)}catch(e){console.error("Parse error:",e)}}}return a}export{A as sendChatMessage};
